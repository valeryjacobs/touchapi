<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="/ico/favicon.ico">

    <title>API Management Demo Admin Console</title>

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="js/knockout-3.1.0.js"></script>


    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
    <div class="container">
        <div class="jumbotron">
            <h1>Select Demo</h1>
            <h2>
                <select data-bind="options: availablePresets,
                                    value:selectedPreset,
                                     optionsText: 'Name',
                                     optionsCaption: 'Choose a preset'"></select>
            </h2>
            <h3><span data-bind="text: selectedPreset"></span></h3>
            <!--<span data-bind="text: fullName"></span>-->
        </div>

        <div class="row marketing">

            <div class="form-group" data-bind="with: selectedPreset">
                <div data-bind="with: Settings">
                    <input type="text" class="form-control" data-bind="value: head" placeholder="Head">


                    <input type="text" class="form-control" data-bind="value: title" placeholder="Title">
                    <input type="text" class="form-control" data-bind="value: buttontext" placeholder="Button text">
                    <input type="text" class="form-control" data-bind="value: url" placeholder="API URL">
                    <input type="text" class="form-control" data-bind="value: method" placeholder="HTTP Method">
                    <input type="text" class="form-control" data-bind="value: user" placeholder="User name">
                    <input type="text" class="form-control" data-bind="value: pwd" placeholder="Pasword">
                    <input type="text" class="form-control" data-bind="value: headers" placeholder="headers">
                    <input type="text" class="form-control" data-bind="value: requesttitle" placeholder="Request title">
                    <input type="text" class="form-control" data-bind="value: request" placeholder="Request">
                    <input type="text" class="form-control" data-bind="value: responsetitle" placeholder="Response title">
                    <input type="text" class="form-control" data-bind="value: response" placeholder="Response">
                    <input type="text" class="form-control" data-bind="value: requestform" placeholder="Request form">
                </div>
            </div>
            <h1><button id="button" class="btn btn-default">GO</button></h1>

        </div>
        <div class="footer">
            <p>&copy; CloudCompanion 2014</p>
        </div>
    </div>

    <script src="Scripts/jquery-1.6.4.min.js"></script>
    <script src="Scripts/jquery.dform-1.1.0.js"></script>
    <script src="/Scripts/jquery.signalR-2.0.0.js"></script>
    <script type="text/javascript" src="js/jquery.linq.min.js"></script>
    <script type="text/javascript" src="js/linq.min.js"></script>
    <script src="/signalr/hubs"></script>
    <script type="text/javascript">
        $(function () {


            var presets = [{
                "Name": "Demo1",
                "Order": 0,
                "Settings":
                {
                    "title": "API Management Demo App",
                    "head": "Flickr API Demo",
                    "headtext": "Let's call the flickr REST API and have some fun!",
                    "buttontext": "MAKE CALL",
                    "url": "https://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?",
                    "method": "GET",
                    "requestform": {
                        "html":
                        [
                            {
                                "name": "tags",
                                "id": "tags",
                                "caption": "tags",
                                "type": "text",
                                "placeholder": "Enter a the 'tags' param.",
                                "value": "holiday"
                            }
                        ]
                    },
                    "user": "me",
                    "pwd": "youwish",
                    "headers": "",
                    "requesttitle": "Fill in the form to set the request body:",
                    "request": { "tags": "default", "tagmode": "any", "format": "json" },
                    "responsetitle": "Response:",
                    "response": "Nothing called yet..."
                }
            },
              {
                  "Name": "Demo2",
                  "Order": 0,
                  "Settings":
                  {
                      "title": "API Management Demo App",
                      "head": "OData feed demo",
                      "headtext": "Let's call an ODATA service and see what happens!",
                      "buttontext": "CALL ODATA FEED",
                      "url": "http://localhost:52527/odata/Attendees",
                      "method": "GET",
                      "requestform": "",
                      "user": "me",
                      "pwd": "youwish",
                      "headers": "",
                      "requesttitle": "No parameters for this request defined.",
                      "request": "",
                      "responsetitle": "Response:",
                      "response": "Nothing called yet..."
                  }
              }
            ];

            var queryResult = Enumerable.From(presets).Select().ToArray();

            function ViewModel() {
                this.title = ko.observable("API Management Demo App");
                this.head = ko.observable("Flickr API Demo");

                this.headtext = ko.observable("Let's call the flickr REST API and have some fun!");
                this.buttontext = ko.observable("Call Flickr API");
                this.url = ko.observable("https://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?");
                this.method = ko.observable("GET");
                this.requestform = ko.observable({
                    "html":
                    [
                        {
                            "name": "tags",
                            "id": "tags",
                            "caption": "tags",
                            "type": "text",
                            "placeholder": "Enter a the 'tags' param.",
                            "value": "holiday"
                        }
                    ]
                });
                this.user = ko.observable("me");
                this.pwd = ko.observable("S@cret");
                this.headers = ko.observable("");
                this.requesttitle = ko.observable("Fill in the form to set the request body:");
                this.request = ko.observable({ tags: "default", tagmode: "any", format: "json" });
                this.responsetitle = ko.observable("Response:");
                this.response = ko.observable("...");
                this.availablePresets = ko.observable(queryResult);
                this.selectedPreset = ko.observable();
                ////this.fullName = ko.computed(function () {
                ////    return this.head() + " " + this.url() + "  " + ;
                //}, this);
            };

            var avm = new ViewModel();
            ko.applyBindings(avm);

            var chat = $.connection.chatHub;
            //chat.client.updateState = function (state) {
            //    var state = jQuery.parseJSON(state);
            //    avm.head(state.head);
            //    avm.title(state.title);
            //    avm.buttontext(state.buttontext);
            //    avm.url(state.url);
            //    avm.method(state.method);
            //    avm.headers(state.headers);
            //    avm.pwd(state.pwd);
            //    avm.user(state.user);
            //    avm.request(state.request);
            //    avm.requesttitle(state.requesttitle);
            //    avm.response(state.response);
            //    avm.responsetitle(state.responsetitle);
            //};

            $.connection.hub.start().done(function () {
                $('#button').click(function () {
                    var jsonData = ko.toJSON(avm.selectedPreset().Settings);
                    chat.server.send(jsonData);
                });
            });


        });
    </script>
</body>
</html>
